<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ø§Ù„Ù…Ø¹Ù„Ù‘Ù… Ø§Ù„Ø°ÙƒÙŠ | Ù…Ù†ØµØ© Ø§Ù„ØªØ­ÙÙŠØ¸</title>
/* Ø¥Ø®ÙØ§Ø¡ Ø£ÙŠ ØªØ­ÙƒÙ‘Ù… Ø®Ø§Ø±Ø¬ Ø§Ù„Ù„ÙˆØ­Ø© Ø§Ù„ÙŠÙ…Ù†Ù‰ (Ø§Ø®ØªØ¨Ø§Ø±) */
body > .header .btn-row,
body > .header select,
body > .header button,
body > .header .controls,
body > .header [id="surah"],
body > .header [id="reciter"],
body > .header .lang-btn { display:none !important; }
  <script>
  (function dedupeControls(){
    const panel = document.querySelector('aside.controls-sidebar');
    const inside = el => panel && panel.contains(el);

    document.querySelectorAll('.lang-btn').forEach(el=>{ if(!inside(el)) el.remove(); });
    ['surah','reciter'].forEach(id=>{
      document.querySelectorAll('#'+id).forEach(el=>{ if(!inside(el)) el.remove(); });
    });
  })();
</script>


  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:'Traditional Arabic',Arial,sans-serif;background:linear-gradient(135deg,#667eea,#764ba2);direction:rtl;min-height:100vh;padding:15px}
    .header{background:#fff;padding:20px;border-radius:12px;box-shadow:0 4px 15px rgba(0,0,0,0.2);margin-bottom:15px;text-align:center}
    h1{color:#667eea;font-size:28px;margin-bottom:5px}
    .subtitle{color:#666;font-size:15px;margin-bottom:10px}
    .main-container{display:flex;gap:15px;max-width:1600px;margin:0 auto}
    .controls-sidebar{width:320px;flex-shrink:0}
    .controls{background:#fff;padding:18px;border-radius:12px;box-shadow:0 4px 15px rgba(0,0,0,0.2);margin-bottom:15px}
    .section{margin-bottom:15px;padding-bottom:15px;border-bottom:1px solid #eee}
    .section:last-child{border-bottom:none;margin-bottom:0}
    .label{font-size:15px;color:#667eea;font-weight:bold;margin-bottom:8px;display:block}
    select{padding:8px 12px;font-size:14px;border:2px solid #667eea;border-radius:20px;background:#fff;color:#667eea;cursor:pointer;width:100%}
    .btn-row{display:flex;flex-wrap:wrap;gap:6px}
    button{padding:8px 15px;font-size:13px;border:2px solid #667eea;border-radius:18px;background:#667eea;color:#fff;cursor:pointer;transition:all .3s;font-weight:bold;flex:1;min-width:80px}
    button:hover{background:#764ba2;border-color:#764ba2;transform:translateY(-1px)}
    button:disabled{opacity:.5;cursor:not-allowed}
    .lang-btn{background:#fff;color:#667eea;font-size:12px;min-width:60px}
    .lang-btn.active{background:#667eea;color:#fff}
    #reveal-btn{background:#28a745;border-color:#28a745}
    #reveal-btn:hover{background:#218838;border-color:#218838}
    #content{flex:1;background:#fff;padding:15px;border-radius:12px;box-shadow:0 4px 15px rgba(0,0,0,0.2);max-height:calc(100vh - 100px);overflow-y:auto}
    .title{text-align:center;color:#667eea;font-size:24px;margin-bottom:12px;padding-bottom:8px;border-bottom:2px solid #667eea}
    .verse{margin-bottom:5px;padding:10px;background:#f8f9ff;border-radius:8px;transition:all .4s;position:relative}
    .verse:hover{box-shadow:0 2px 8px rgba(102,126,234,.15)}
    .verse.playing{background:#fff3cd;box-shadow:0 4px 12px rgba(255,215,0,.4)}
    .verse-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
    .num{display:inline-block;background:#667eea;color:#fff;padding:2px 8px;border-radius:12px;font-size:11px;font-weight:bold}
    .verse-controls{display:flex;gap:5px}
    .verse-btn{padding:5px 10px;font-size:12px;min-width:auto;border-radius:12px}
    .play-verse-btn{background:#ff6b6b;border-color:#ff6b6b}
    .repeat-verse-btn{background:#ffd93d;border-color:#ffd93d;color:#333}
    .record-verse-btn{background:#1a73e8;border-color:#1a73e8}
    .stop-record-btn{background:#ea4335;border-color:#ea4335}
    .arabic{font-size:24px;line-height:1.6;margin-bottom:6px;direction:rtl;text-align:right;color:#1a1a1a}
    .translit{font-size:15px;line-height:1.3;margin-bottom:3px;color:#555;font-style:italic;direction:ltr;text-align:left;font-family:Georgia,serif}
    .trans{font-size:15px;line-height:1.3;color:#333;padding:6px;background:#fff;border-left:3px solid #667eea;border-radius:4px;direction:ltr;text-align:left}
    .word{display:inline-block;padding:2px 4px;margin:1px;cursor:pointer;transition:all .3s;border-radius:3px}
    .word:hover{background:#fff3cd}
    .word.hidden{color:transparent;background:#ddd;user-select:none}
    .word.revealed{background:#d4edda!important;color:#155724!important}
    .user-playback{margin-top:10px;padding-top:10px;border-top:1px dashed #ccc}
    .user-playback audio{width:100%;margin-top:5px}
    .loading{text-align:center;padding:40px;font-size:20px;color:#667eea}
    @media (max-width:1024px){.main-container{flex-direction:column}.controls-sidebar{width:100%}#content{max-height:none}}
  </style>
</head>
<body>

  <!-- Ù‡ÙŠØ¯Ø± Ø¨Ø³ÙŠØ· Ø¨Ø¯ÙˆÙ† Ø£ÙŠ Ø¹Ù†Ø§ØµØ± ØªØ­ÙƒÙ‘Ù… Ù…ÙƒØ±Ù‘Ø±Ø© -->
  <div class="header">
    <h1>ğŸ“– Ù…Ù†ØµØ© ØªØ­ÙÙŠØ¸ Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ…</h1>
    <p class="subtitle">Quran Memorization Platform</p>
  </div>

  <div class="main-container">
    <aside class="controls-sidebar">
      <div class="controls">
        <div class="section">
          <label class="label">Ø§Ù„Ø³ÙˆØ±Ø©</label>
          <select id="surah"></select>
        </div>

        <div class="section">
          <label class="label">Ø§Ù„Ù‚Ø§Ø±Ø¦</label>
          <select id="reciter">
            <option value="ar.alafasy">Ù…Ø´Ø§Ø±ÙŠ Ø§Ù„Ø¹ÙØ§Ø³ÙŠ</option>
            <option value="ar.abdulbasitmurattal">Ø¹Ø¨Ø¯Ø§Ù„Ø¨Ø§Ø³Ø· (Ù…Ø±ØªÙ„)</option>
            <option value="ar.abdurrahmaansudais">Ø§Ù„Ø³Ø¯ÙŠØ³</option>
            <option value="ar.shaatree">Ø§Ù„Ø´Ø§Ø·Ø±ÙŠ</option>
            <option value="ar.husary">Ø§Ù„Ø­ØµØ±ÙŠ</option>
            <option value="ar.minshawi">Ø§Ù„Ù…Ù†Ø´Ø§ÙˆÙŠ</option>
          </select>
        </div>

        <div class="section">
          <label class="label">Ø§Ù„Ù„ØºØ©</label>
          <div class="btn-row">
            <button class="lang-btn" data-ed="es.cortes">ES</button>
            <button class="lang-btn" data-ed="fr.hamidullah">FR</button>
            <button class="lang-btn" data-ed="en.asad">EN</button>
            <button class="lang-btn active" data-ed="ar">Ø¹</button>
            <button class="lang-btn" data-ed="it.piccardo">IT</button>
            <button class="lang-btn" data-ed="de.bubenheim">DE</button>
          </div>
        </div>

        <div class="section">
          <label class="label">Ù†Ø³Ø¨Ø© Ø§Ù„Ø¥Ø®ÙØ§Ø¡</label>
          <select id="hide-percentage">
            <option value="10">10%</option><option value="20">20%</option><option value="30">30%</option><option value="40">40%</option>
            <option value="50" selected>50%</option><option value="60">60%</option><option value="70">70%</option><option value="80">80%</option><option value="90">90%</option><option value="100">100%</option>
          </select>
        </div>

        <div class="section">
          <div class="btn-row">
            <button id="hide-btn">ğŸ¯ Ø¥Ø®ÙØ§Ø¡</button>
            <button id="reveal-btn">âœ“ Ø¥Ø¸Ù‡Ø§Ø±</button>
          </div>
        </div>
      </div>
    </aside>

    <main id="content"><div class="loading">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div></main>
  </div>

  <audio id="audio-player" style="display:none"></audio>

  <script>
    // Ù…Ù„Ø¡ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø³ÙˆØ±
    (function fillSurahs(){
      const names=["Ø§Ù„ÙØ§ØªØ­Ø©","Ø§Ù„Ø¨Ù‚Ø±Ø©","Ø¢Ù„ Ø¹Ù…Ø±Ø§Ù†","Ø§Ù„Ù†Ø³Ø§Ø¡","Ø§Ù„Ù…Ø§Ø¦Ø¯Ø©","Ø§Ù„Ø£Ù†Ø¹Ø§Ù…","Ø§Ù„Ø£Ø¹Ø±Ø§Ù","Ø§Ù„Ø£Ù†ÙØ§Ù„","Ø§Ù„ØªÙˆØ¨Ø©","ÙŠÙˆÙ†Ø³","Ù‡ÙˆØ¯","ÙŠÙˆØ³Ù","Ø§Ù„Ø±Ø¹Ø¯","Ø¥Ø¨Ø±Ø§Ù‡ÙŠÙ…","Ø§Ù„Ø­Ø¬Ø±","Ø§Ù„Ù†Ø­Ù„","Ø§Ù„Ø¥Ø³Ø±Ø§Ø¡","Ø§Ù„ÙƒÙ‡Ù","Ù…Ø±ÙŠÙ…","Ø·Ù‡","Ø§Ù„Ø£Ù†Ø¨ÙŠØ§Ø¡","Ø§Ù„Ø­Ø¬","Ø§Ù„Ù…Ø¤Ù…Ù†ÙˆÙ†","Ø§Ù„Ù†ÙˆØ±","Ø§Ù„ÙØ±Ù‚Ø§Ù†","Ø§Ù„Ø´Ø¹Ø±Ø§Ø¡","Ø§Ù„Ù†Ù…Ù„","Ø§Ù„Ù‚ØµØµ","Ø§Ù„Ø¹Ù†ÙƒØ¨ÙˆØª","Ø§Ù„Ø±ÙˆÙ…","Ù„Ù‚Ù…Ø§Ù†","Ø§Ù„Ø³Ø¬Ø¯Ø©","Ø§Ù„Ø£Ø­Ø²Ø§Ø¨","Ø³Ø¨Ø£","ÙØ§Ø·Ø±","ÙŠØ³","Ø§Ù„ØµØ§ÙØ§Øª","Øµ","Ø§Ù„Ø²Ù…Ø±","ØºØ§ÙØ±","ÙØµÙ„Øª","Ø§Ù„Ø´ÙˆØ±Ù‰","Ø§Ù„Ø²Ø®Ø±Ù","Ø§Ù„Ø¯Ø®Ø§Ù†","Ø§Ù„Ø¬Ø§Ø«ÙŠØ©","Ø§Ù„Ø£Ø­Ù‚Ø§Ù","Ù…Ø­Ù…Ø¯","Ø§Ù„ÙØªØ­","Ø§Ù„Ø­Ø¬Ø±Ø§Øª","Ù‚","Ø§Ù„Ø°Ø§Ø±ÙŠØ§Øª","Ø§Ù„Ø·ÙˆØ±","Ø§Ù„Ù†Ø¬Ù…","Ø§Ù„Ù‚Ù…Ø±","Ø§Ù„Ø±Ø­Ù…Ù†","Ø§Ù„ÙˆØ§Ù‚Ø¹Ø©","Ø§Ù„Ø­Ø¯ÙŠØ¯","Ø§Ù„Ù…Ø¬Ø§Ø¯Ù„Ø©","Ø§Ù„Ø­Ø´Ø±","Ø§Ù„Ù…Ù…ØªØ­Ù†Ø©","Ø§Ù„ØµÙ","Ø§Ù„Ø¬Ù…Ø¹Ø©","Ø§Ù„Ù…Ù†Ø§ÙÙ‚ÙˆÙ†","Ø§Ù„ØªØºØ§Ø¨Ù†","Ø§Ù„Ø·Ù„Ø§Ù‚","Ø§Ù„ØªØ­Ø±ÙŠÙ…","Ø§Ù„Ù…Ù„Ùƒ","Ø§Ù„Ù‚Ù„Ù…","Ø§Ù„Ø­Ø§Ù‚Ø©","Ø§Ù„Ù…Ø¹Ø§Ø±Ø¬","Ù†ÙˆØ­","Ø§Ù„Ø¬Ù†","Ø§Ù„Ù…Ø²Ù…Ù„","Ø§Ù„Ù…Ø¯Ø«Ø±","Ø§Ù„Ù‚ÙŠØ§Ù…Ø©","Ø§Ù„Ø¥Ù†Ø³Ø§Ù†","Ø§Ù„Ù…Ø±Ø³Ù„Ø§Øª","Ø§Ù„Ù†Ø¨Ø£","Ø§Ù„Ù†Ø§Ø²Ø¹Ø§Øª","Ø¹Ø¨Ø³","Ø§Ù„ØªÙƒÙˆÙŠØ±","Ø§Ù„Ø§Ù†ÙØ·Ø§Ø±","Ø§Ù„Ù…Ø·ÙÙÙŠÙ†","Ø§Ù„Ø§Ù†Ø´Ù‚Ø§Ù‚","Ø§Ù„Ø¨Ø±ÙˆØ¬","Ø§Ù„Ø·Ø§Ø±Ù‚","Ø§Ù„Ø£Ø¹Ù„Ù‰","Ø§Ù„ØºØ§Ø´ÙŠØ©","Ø§Ù„ÙØ¬Ø±","Ø§Ù„Ø¨Ù„Ø¯","Ø§Ù„Ø´Ù…Ø³","Ø§Ù„Ù„ÙŠÙ„","Ø§Ù„Ø¶Ø­Ù‰","Ø§Ù„Ø´Ø±Ø­","Ø§Ù„ØªÙŠÙ†","Ø§Ù„Ø¹Ù„Ù‚","Ø§Ù„Ù‚Ø¯Ø±","Ø§Ù„Ø¨ÙŠÙ†Ø©","Ø§Ù„Ø²Ù„Ø²Ù„Ø©","Ø§Ù„Ø¹Ø§Ø¯ÙŠØ§Øª","Ø§Ù„Ù‚Ø§Ø±Ø¹Ø©","Ø§Ù„ØªÙƒØ§Ø«Ø±","Ø§Ù„Ø¹ØµØ±","Ø§Ù„Ù‡Ù…Ø²Ø©","Ø§Ù„ÙÙŠÙ„","Ù‚Ø±ÙŠØ´","Ø§Ù„Ù…Ø§Ø¹ÙˆÙ†","Ø§Ù„ÙƒÙˆØ«Ø±","Ø§Ù„ÙƒØ§ÙØ±ÙˆÙ†","Ø§Ù„Ù†ØµØ±","Ø§Ù„Ù…Ø³Ø¯","Ø§Ù„Ø¥Ø®Ù„Ø§Øµ","Ø§Ù„ÙÙ„Ù‚","Ø§Ù„Ù†Ø§Ø³"];
      const sel=document.getElementById('surah');
      for(let i=1;i<=114;i++){ const o=document.createElement('option'); o.value=i; o.textContent=`${i}-${names[i-1]}`; sel.appendChild(o); }
    })();

    let curS=1,curE='ar',audio=document.getElementById('audio-player'),audioData=null;
    let mediaRecorder, audioChunks=[];

    // Ù‚Ø±Ø§Ø¡Ø© Ø¨Ø§Ø±Ø§Ù…ÙŠØªØ±Ø§Øª Ø§Ù„Ø±Ø§Ø¨Ø· ÙˆØªÙØ¹ÙŠÙ„ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
    (function initFromQuery(){
      const q=new URLSearchParams(location.search);
      const lang=q.get('lang'); const rec=q.get('reciter'); const s=q.get('surah');
      const a1=q.get('start');  const a2=q.get('end');
      if(lang) curE=lang;
      if(s && !isNaN(+s)) curS=+s;

      const langBtn=document.querySelector(`.lang-btn[data-ed="${curE}"]`);
      if(langBtn){ document.querySelectorAll('.lang-btn').forEach(x=>x.classList.remove('active')); langBtn.classList.add('active'); }
      const recSel=document.getElementById('reciter');
      if(recSel && rec && [...recSel.options].some(o=>o.value===rec)) recSel.value=rec;
      const sSel=document.getElementById('surah'); if(sSel) sSel.value=curS;

      window.__range={ start:a1?+a1:null, end:a2?+a2:null };
    })();

    async function fetchWithTimeout(resource, options = {}, timeout = 20000){
      const controller=new AbortController(); const id=setTimeout(()=>controller.abort(),timeout);
      try{ const res=await fetch(resource,{...options,signal:controller.signal}); clearTimeout(id); return res; }catch(e){ clearTimeout(id); throw e; }
    }

    function clipRange(dataObj){
      if(!dataObj || !dataObj.ayahs || !window.__range) return dataObj;
      const {start,end}=window.__range; if(!start && !end) return dataObj;
      const ayahs=dataObj.ayahs.filter(a=>{ const n=a.numberInSurah; if(start && n<start) return false; if(end && n>end) return false; return true; });
      return {...dataObj, ayahs};
    }

    async function load(n,e){
      const c=document.getElementById('content'); c.innerHTML='<div class="loading">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>';
      try{
        const arRes=await fetchWithTimeout(`https://api.alquran.cloud/v1/surah/${n}`); if(!arRes.ok) throw new Error();
        const ar=await arRes.json();

        const trRes=await fetchWithTimeout(`https://api.alquran.cloud/v1/surah/${n}/en.transliteration`); if(!trRes.ok) throw new Error();
        const tr=await trRes.json();

        const reciter=document.getElementById('reciter').value;
        const audioRes=await fetchWithTimeout(`https://api.alquran.cloud/v1/surah/${n}/${reciter}`); if(!audioRes.ok) throw new Error();
        audioData=(await audioRes.json()).data.ayahs;

        if(window.__range && (window.__range.start||window.__range.end)){
          const {start,end}=window.__range;
          audioData=audioData.filter(x=>{ const num=x.numberInSurah; if(start && num<start) return false; if(end && num>end) return false; return true; });
        }

        let transData=null;
        if(e!=='ar'){ const tRes=await fetchWithTimeout(`https://api.alquran.cloud/v1/surah/${n}/${e}`); if(tRes.ok){ const t=await tRes.json(); transData=t.data; } }

        let arData=clipRange(ar.data), trData=clipRange(tr.data);
        if(transData) transData=clipRange(transData);

        show(arData,trData,transData);
      }catch(err){ c.innerHTML='<div class="loading">ØªØ¹Ø°Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„. Ø£Ø¹Ø¯ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù„Ø§Ø­Ù‚Ù‹Ø§.</div>'; console.error(err); }
    }

    function show(ar,tr,trans){
      const c=document.getElementById('content');
      let h=`<h2 class="title">${ar.name} - ${ar.englishName}</h2>`;
      ar.ayahs.forEach((a,vi)=>{
        const aw=a.text.split(' '); const tw=tr.ayahs[vi]?tr.ayahs[vi].text.split(' '):[];
        h+=`<div class="verse" data-ayah="${vi}"><div class="verse-header"><div class="num">${a.numberInSurah}</div><div class="verse-controls">
            <button class="verse-btn play-verse-btn" onclick="playVerse(${vi})">â–¶</button>
            <button class="verse-btn repeat-verse-btn" onclick="repeatVerse(${vi})">ğŸ”</button>
            <button class="verse-btn record-verse-btn" id="record-${vi}" onclick="startRecording(this, ${vi})">ğŸ¤</button>
            <button class="verse-btn stop-record-btn" id="stop-${vi}" onclick="stopRecording(this, ${vi})" style="display:none;">â¹ï¸</button>
          </div></div>`;
        h+=`<div class="arabic">`; aw.forEach((w,wi)=>{ h+=`<span class="word aw" data-v="${vi}" data-w="${wi}">${w} </span>`; }); h+=`</div>`;
        if(tw.length){ h+=`<div class="translit">`; tw.forEach((w,wi)=>{ h+=`<span class="word tw" data-v="${vi}" data-w="${wi}">${w} </span>`; }); h+=`</div>`; }
        if(trans && trans.ayahs[vi]) h+=`<div class="trans">${trans.ayahs[vi].text}</div>`;
        h+=`<div class="user-playback" id="playback-${vi}" style="display:none;"><p style="font-size:14px;margin-top:10px;font-weight:bold;">ØªØ³Ø¬ÙŠÙ„Ùƒ:</p><audio controls></audio></div></div>`;
      });
      c.innerHTML=h;

      document.querySelectorAll('.word').forEach(w=>{
        w.onclick=function(){
          if(this.classList.contains('hidden')){
            this.classList.remove('hidden'); this.classList.add('revealed');
            const v=this.dataset.v, wi=this.dataset.w, other=this.classList.contains('aw')?'tw':'aw';
            const paired=document.querySelector(`.${other}[data-v="${v}"][data-w="${wi}"]`);
            if(paired){ paired.classList.remove('hidden'); paired.classList.add('revealed'); }
          }
        }
      });
    }

    window.playVerse=function(i){
      document.querySelectorAll('.verse').forEach(v=>v.classList.remove('playing'));
      const verse=document.querySelector(`.verse[data-ayah="${i}"]`); if(verse){ verse.classList.add('playing'); verse.scrollIntoView({behavior:'smooth',block:'center'}); }
      if(audioData&&audioData[i]){ audio.src=audioData[i].audio; audio.play(); audio.onended=()=>{ if(verse) verse.classList.remove('playing'); }; }
    };
    window.repeatVerse=function(i){ playVerse(i); };

    window.startRecording=async function(btn,i){
      if(mediaRecorder && mediaRecorder.state==='recording'){ alert('Ù‡Ù†Ø§Ùƒ ØªØ³Ø¬ÙŠÙ„ Ø¬Ø§Ø±Ù. Ø£ÙˆÙ‚ÙÙ‡ Ø£ÙˆÙ„Ø§Ù‹.'); return; }
      try{
        const stream=await navigator.mediaDevices.getUserMedia({audio:true}); mediaRecorder=new MediaRecorder(stream);
        const stopBtn=document.getElementById(`stop-${i}`); btn.style.display='none'; stopBtn.style.display='inline-block';
        const pb=document.getElementById(`playback-${i}`); if(pb) pb.style.display='none';
        audioChunks=[]; mediaRecorder.start();
        mediaRecorder.ondataavailable=e=>audioChunks.push(e.data);
        mediaRecorder.onstop=()=>{ const blob=new Blob(audioChunks,{type:'audio/wav'}); const url=URL.createObjectURL(blob);
          if(pb){ const a=pb.querySelector('audio'); a.src=url; pb.style.display='block'; } stream.getTracks().forEach(t=>t.stop()); };
      }catch(err){ alert('Ø¥Ø°Ù† Ø§Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ† Ù…Ø±ÙÙˆØ¶. ÙØ¹Ù‘Ù„ Ø§Ù„Ø¥Ø°Ù† Ù…Ù† Ø§Ù„Ù…ØªØµÙØ­.'); console.error(err); }
    };
    window.stopRecording=function(btn,i){
      if(mediaRecorder && mediaRecorder.state==='recording') mediaRecorder.stop();
      const recBtn=document.getElementById(`record-${i}`); btn.style.display='none'; recBtn.style.display='inline-block';
    };

    document.querySelectorAll('.lang-btn').forEach(b=>{
      b.onclick=function(){ document.querySelectorAll('.lang-btn').forEach(x=>x.classList.remove('active')); this.classList.add('active'); curE=this.dataset.ed; load(curS,curE); }
    });
    document.getElementById('surah').onchange=function(){ curS=this.value; audio.pause(); load(curS,curE); };
    document.getElementById('reciter').onchange=function(){ audio.pause(); load(curS,curE); };
    document.getElementById('hide-btn').onclick=function(){
      const p=parseInt(document.getElementById('hide-percentage').value,10);
      document.querySelectorAll('.word').forEach(w=>{ w.classList.remove('revealed'); w.classList.remove('hidden'); });
      const aw=[...document.querySelectorAll('.aw')]; const cnt=Math.floor(aw.length*(p/100));
      aw.sort(()=>Math.random()-0.5); for(let i=0;i<cnt;i++){ const A=aw[i]; A.classList.add('hidden');
        const v=A.dataset.v, wi=A.dataset.w, T=document.querySelector(`.tw[data-v="${v}"][data-w="${wi}"]`); if(T) T.classList.add('hidden'); }
    };
    document.getElementById('reveal-btn').onclick=function(){ document.querySelectorAll('.word').forEach(w=>{ w.classList.remove('hidden'); w.classList.remove('revealed'); }); };

    // Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£ÙˆÙ„ÙŠ
    load(curS,curE);
  </script>
</body>
</html>
